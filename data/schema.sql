CREATE TABLE lab_user(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    ssn VARCHAR2(20) NOT NULL,
    sex VARCHAR2(30) NOT NULL,
    email VARCHAR2(50) NOT NULL,
    birth DATE NOT NULL,
    phone VARCHAR2(12) NOT NULL,
    name VARCHAR2(50) NOT NULL,
    address VARCHAR2(100) NOT NULL,
    role VARCHAR2(50) NOT NULL,
    dept_id NUMBER NOT NULL,
    user_name VARCHAR2(100) NOT NULL,
    password VARCHAR2(50) NOT NULL,
    avatar VARCHAR2(256) NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (id),
    CONSTRAINT unique_ssn UNIQUE (ssn),
    CONSTRAINT unique_user_name UNIQUE (user_name)
);

CREATE TABLE lab_dept(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    location VARCHAR2(256) NOT NULL,
    name VARCHAR2(256) NOT NULL,
    manager_id NUMBER NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (manager_id) REFERENCES lab_user(id)
);

CREATE TABLE lab_subject(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR2(256) NOT NULL,
    code VARCHAR2(256) NOT NULL,
    dept_id NUMBER NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (dept_id) REFERENCES lab_dept(id),
    CONSTRAINT unique_code UNIQUE (code)
);

CREATE TABLE lab_class(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    name VARCHAR2(256) NOT NULL,
    student_number NUMBER NOT NULL,
    semester VARCHAR2(50) NOT NULL,
    is_active VARCHAR(10) NOT NULL,
    end_date DATE NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE lab_document(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    title VARCHAR2(256) NOT NULL,
    url VARCHAR2(256) NOT NULL,
    user_id NUMBER NOT NULL,
    class_id NUMBER NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (user_id) REFERENCES lab_user(id),
    FOREIGN KEY (class_id) REFERENCES lab_class(id)
);

CREATE TABLE lab_learn(
    subject_id NUMBER NOT NULL,
    user_id NUMBER NOT NULL,
    class_id NUMBER NOT NULL,
    final_score FLOAT(126),
    midterm_score FLOAT(126),
    assignment_score FLOAT(126),
    quiz_score FLOAT(126),
    status VARCHAR2(20) NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (subject_id, user_id, class_id),
    FOREIGN KEY (subject_id) REFERENCES lab_subject(id),
    FOREIGN KEY (user_id) REFERENCES lab_user(id),
    FOREIGN KEY (class_id) REFERENCES lab_class(id)
);

CREATE TABLE lab_parent(
    parent_id NUMBER NOT NULL,
    student_id NUMBER NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (parent_id, student_id),
    FOREIGN KEY (parent_id) REFERENCES lab_user(id),
    FOREIGN KEY (student_id) REFERENCES lab_user(id)
);

CREATE TABLE lab_teach(
    user_id NUMBER NOT NULL,
    class_id NUMBER NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (user_id, class_id),
    FOREIGN KEY (user_id) REFERENCES lab_user(id),
    FOREIGN KEY (class_id) REFERENCES lab_class(id)
);

CREATE TABLE lab_notification(
    id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    mess_body VARCHAR2(256) NOT NULL,
    mess_header VARCHAR2(256) NOT NULL,
    send_date DATE NOT NULL,
    user_id NUMBER NOT NULL,
    class_id NUMBER NOT NULL,
    deleted NUMBER(1) NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (user_id) REFERENCES lab_user(id),
    FOREIGN KEY (class_id) REFERENCES lab_class(id)
);

/* INSERT lab_user DATA */

INSERT INTO lab_user (ssn,sex,email,birth,phone,name,address,role,dept_id,user_name,password,avatar,deleted)
    VALUES (1,'MALE','1@gmail.com',TO_DATE('13-NOV-2023'),'0909191919','DATLE','ABC Street','student',1,'DATLE','user','example.com',1);

INSERT INTO lab_user (ssn,sex,email,birth,phone,name,address,role,dept_id,user_name,password,avatar,deleted)
    VALUES (2,'FEMALE','2@gmail.com',TO_DATE('14-NOV-2023'),'0909191920','DAT2','ABCD Street','parent',2,'LONGBIEN','user','example.com',1);

INSERT INTO lab_user (ssn,sex,email,birth,phone,name,address,role,dept_id,user_name,password,avatar,deleted)
    VALUES (3,'FEMALE','3@gmail.com',TO_DATE('15-NOV-2023'),'0909191921','HOANHAO','HH Street','teacher',1,'HH','user','example.com',1);

/* INSERT lab_dept DATA */

INSERT INTO lab_dept (location,name,manager_id,deleted) VALUES ('DEPARTMENT 1','Khoa May Tinh',1,1);
INSERT INTO lab_dept (location,name,manager_id,deleted) VALUES ('DEPARTMENT 2','Khoa May Tinh',1,1);
INSERT INTO lab_dept (location,name,manager_id,deleted) VALUES ('DEPARTMENT 3','Khoa May Tinh',2,1);

/* ADD CONSTRAINT */

ALTER TABLE lab_user ADD CONSTRAINT dept_fk FOREIGN KEY (dept_id) REFERENCES lab_dept(id);

/* INSERT lab_subject DATA */

INSERT INTO lab_subject (name,code,dept_id,deleted) VALUES ('BMHTTT','CO11',1,1);
INSERT INTO lab_subject (name,code,dept_id,deleted) VALUES ('MMVANM','CO12',2,1);
INSERT INTO lab_subject (name,code,dept_id,deleted) VALUES ('NLNNLT','CO13',3,1);

/* INSERT lab_class DATA */

INSERT INTO lab_class (name,student_number,semester,is_active,end_date,deleted) VALUES ('L01',30,'232','TRUE',TO_DATE('15-NOV-2023'),1);
INSERT INTO lab_class (name,student_number,semester,is_active,end_date,deleted) VALUES ('L02',35,'232','TRUE',TO_DATE('15-NOV-2023'),1);
INSERT INTO lab_class (name,student_number,semester,is_active,end_date,deleted) VALUES ('L03',40,'232','TRUE',TO_DATE('15-NOV-2023'),1);

/* INSERT lab_document DATA */

INSERT INTO lab_document (title,url,user_id,class_id,deleted) VALUES ('De Thi GK','example.com',1,2,1);
INSERT INTO lab_document (title,url,user_id,class_id,deleted) VALUES ('De Thi CK','example.com',1,1,1);
INSERT INTO lab_document (title,url,user_id,class_id,deleted) VALUES ('De BTL','example.com',2,2,1);

/* INSERT lab_learn DATA */

INSERT INTO lab_learn (subject_id,user_id,class_id,final_score,midterm_score,assignment_score,quiz_score,status,deleted) 
    VALUES (1,1,1,10,10,10,10,'active',1);
INSERT INTO lab_learn (subject_id,user_id,class_id,final_score,midterm_score,assignment_score,quiz_score,status,deleted) 
    VALUES (1,2,1,10,10,10,10,'active',1);
INSERT INTO lab_learn (subject_id,user_id,class_id,final_score,midterm_score,assignment_score,quiz_score,status,deleted) 
    VALUES (1,2,3,10,10,10,10,'active',1);

/* INSERT lab_parent DATA */

INSERT INTO lab_parent (parent_id,student_id,deleted) VALUES (1,2,1);
INSERT INTO lab_parent (parent_id,student_id,deleted) VALUES (2,3,1);
INSERT INTO lab_parent (parent_id,student_id,deleted) VALUES (1,3,1);

/* INSERT lab_teach DATA */

INSERT INTO lab_teach (user_id,class_id,deleted) VALUES (1,1,1);
INSERT INTO lab_teach (user_id,class_id,deleted) VALUES (2,2,1);
INSERT INTO lab_teach (user_id,class_id,deleted) VALUES (3,3,1);

/* INSERT lab_notification DATA */

INSERT INTO lab_notification (mess_body,mess_header,send_date,user_id,class_id,deleted) 
    VALUES ('TEST', 'THIS IS A TEST NOTIFICATION',TO_DATE('15-NOV-2023'),1,2,1);
INSERT INTO lab_notification (mess_body,mess_header,send_date,user_id,class_id,deleted) 
    VALUES ('TEST', 'THIS IS A TEST NOTIFICATION',TO_DATE('15-NOV-2023'),1,3,1);
INSERT INTO lab_notification (mess_body,mess_header,send_date,user_id,class_id,deleted) 
    VALUES ('TEST', 'THIS IS A TEST NOTIFICATION',TO_DATE('15-NOV-2023'),2,3,1);